# rmlint 介绍

**rmlint** 是一款高性能的开源命令行工具，专为 Linux 和 Unix 系统设计，用于快速查找和删除文件系统中的重复文件、空文件、损坏的符号链接等冗余数据。

`rmlint` 的效率会比我们手写的 Shell 脚本高出几个量级。**

虽然 Shell 脚本逻辑清晰且无需安装，但在处理**数万个以上**的文件时，专门的工具（尤其是 C 语言编写的 `rmlint`
）在底层架构上做了大量脚本无法实现的优化。

---

### 1. 为什么 `rmlint` 极快？

* **分块哈希 (Incremental Hashing)**：脚本通常会读取整个文件来计算 MD5。`rmlint` 采用“先读头尾”的策略。如果两个 10GB 的文件头部
  4KB 不同，它会在 1 毫秒内排除，而脚本可能还在傻傻地读取整个文件。
* **多线程并发 I/O**：`rmlint` 的 C 代码直接调用系统底层异步 I/O，比通过 `xargs` 频繁启动新进程要快得多。
* **内存映射 (mmap)**：它使用内存映射技术读取文件，减少了内核空间到用户空间的数据拷贝。
* **去重优化 (Reflink)**：在 APFS (Mac 默认格式) 磁盘上，`rmlint` 甚至可以支持克隆文件而不占用双倍空间。

---

### 2. `fdupes` vs `rmlint`

| 特性           | `fdupes`  | `rmlint` (强烈推荐)     |
|--------------|-----------|---------------------|
| **编程语言**     | C         | C (高度优化)            |
| **性能**       | 一般 (逐个对比) | **极快** (三级筛选)       |
| **功能**       | 基础去重      | 查找重复、空目录、损坏链接、重复文件名 |
| **输出**       | 直接删除或列表   | 生成高度可配置的 `.sh` 删除脚本 |
| **MacOS 支持** | 良好        | 卓越 (深度支持 APFS 磁盘)   |

---

### 3. 如何在 Mac 上高效使用 `rmlint`？

这是目前公认的 Mac 处理海量重复文件的“最佳实践”：

#### 第一步：安装

```bash
brew install rmlint

```

#### 第二步：运行扫描

```bash
rmlint /你的文件夹路径

```

*它会立即在屏幕上显示进度条，扫描完成后，会在当前目录下生成两个文件：*

1. `rmlint.json`：扫描结果的原始数据。
2. **`rmlint.sh`**：这是关键，它是一个高度安全的删除脚本。

#### 第三步：执行删除

`rmlint` 生成的脚本默认是不会执行删除的，它非常严谨。

1. **预览检查**：`cat rmlint.sh`
2. **执行删除**：

```bash
./rmlint.sh -d

```

*（`-d` 参数表示执行删除，如果不带 `-d` 运行，它只会告诉你它“本可以”删掉什么。）*

---

### 4. `rmlint` 的进阶黑科技

如果你有特殊需求，`rmlint` 的参数比脚本丰富得多：

* **优先保留某个文件夹**（例如：保留 `Backup` 里的，删除 `Temp` 里的）：

```bash
rmlint --keep-all-tagged /重要备份路径 // /待清理路径

```

* **只找大于 100MB 的重复文件**（效率之王）：

```bash
rmlint --size >100M /路径

```

---

### 总结建议

* 如果文件量在 **1,000 个以内**：使用我之前给你的脚本即可，简单直接。
* 如果文件量在 **10,000 个以上或达到几百 GB**：请务必使用 `rmlint`。它能把几小时的扫描缩短到几分钟。
